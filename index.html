<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FalAI - Universal AI Image Generation</title>

    <!-- PWA metadata -->
    <meta name="description" content="Universal web application for AI image generation APIs">
    <meta name="theme-color" content="#f8fafc">
    <link rel="manifest" href="manifest.json">

    <!-- Styles -->
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/gallery.css">

    <!-- Fabric.js for advanced canvas drawing -->
    <script src="lib/fabric.min.js"></script>

    <!-- PhotoSwipe (MIT) for gallery -->
    <link rel="stylesheet" href="lib/photoswipe.css" />

    <!-- Google Fonts: Inter -->
    <link rel="stylesheet" href="fonts/inter.css">

    <!-- Phosphor Icons -->
    <link rel="stylesheet" href="lib/phosphor-icons.css">

    <!-- Icons -->
    <link rel="icon" href="favicon.png" type="image/png">
    <link rel="apple-touch-icon" href="favicon.png">
</head>
<body>
    <div id="app">
        <header class="header">
            <button id="hamburger-menu" class="hamburger-menu">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <div class="header-branding">
                <img src="logo-header.png" alt="FalAI Logo" class="header-logo">
                <h1>FalAI</h1>
            </div>
            <div class="header-controls">
                <button id="add-endpoint-btn" class="btn secondary" title="Add Custom Endpoint"><i class="ph ph-plus"></i></button>
                <button id="export-settings-btn" class="btn secondary" title="Export Settings"><i class="ph ph-export"></i></button>
                <button id="import-settings-btn" class="btn secondary" title="Import Settings"><i class="ph ph-download-simple"></i></button>
                <button id="reset-settings-btn" class="btn secondary" title="Reset Settings"><i class="ph ph-arrow-counter-clockwise"></i></button>
                <button id="api-key-btn" class="btn secondary">Set API Key</button>
            </div>

            <div class="header-right-actions" style="display: flex; align-items: center; gap: 0.5rem;">
                <label class="theme-toggle" title="Toggle Dark Mode">
                    <input type="checkbox" id="theme-toggle-checkbox">
                    <span class="theme-toggle-slider">
                        <span class="theme-toggle-icon"><i class="ph ph-moon"></i></span>
                        <span class="theme-toggle-icon"><i class="ph ph-sun"></i></span>
                    </span>
                </label>
                <!-- Mobile gallery button (visible on mobile only) -->
                <button id="mobile-gallery-btn" class="mobile-gallery-btn" title="Gallery"><i class="ph ph-image"></i></button>
            </div>
        </header>

        <!-- Mobile Menu Overlay -->
        <div id="mobile-menu-overlay" class="mobile-menu-overlay"></div>

    <!-- Mobile Gallery Overlay -->
    <div id="mobile-gallery-overlay" class="mobile-gallery-overlay"></div>

        <!-- Mobile Menu -->
        <div id="mobile-menu" class="mobile-menu">
            <div class="mobile-menu-header">
                <button id="mobile-menu-close" class="mobile-menu-close"><i class="ph ph-x"></i></button>
            </div>
            <div class="mobile-menu-controls">
                <!-- Control buttons section -->
                <div class="mobile-menu-section collapsible collapsed">
                    <h3 class="section-header">Settings <span class="toggle-icon"><i class="ph ph-caret-down"></i></span></h3>
                    <div class="section-content">
                        <button id="mobile-api-key-btn" class="mobile-menu-btn">Set API Key</button>
                        <button id="mobile-add-endpoint-btn" class="mobile-menu-btn">Add Custom Endpoint</button>
                        <button id="mobile-export-settings-btn" class="mobile-menu-btn">Export Settings</button>
                        <button id="mobile-import-settings-btn" class="mobile-menu-btn">Import Settings</button>
                        <button id="mobile-reset-settings-btn" class="mobile-menu-btn">Reset Settings</button>
                    </div>
                </div>

                <!-- Advanced options section -->
                <div class="mobile-menu-section collapsible">
                    <h3 class="section-header">Advanced Options <span class="toggle-icon"><i class="ph ph-caret-down"></i></span></h3>
                    <div class="section-content">
                        <div id="mobile-advanced-options">
                            <!-- Advanced options will be populated here dynamically -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Mobile Gallery Panel (slides from right) -->
        <div id="mobile-gallery" class="mobile-gallery">
            <div class="mobile-gallery-header">
                <h3>Gallery</h3>
                <div class="mobile-gallery-header-actions">
                    <button id="mobile-gallery-close" class="mobile-gallery-close" title="Close"><i class="ph ph-x"></i></button>
                </div>
            </div>
            <div class="mobile-gallery-meta">
                <div class="mobile-gallery-meta-row">
                    <div class="gallery-inline-actions" data-scope="mobile">
                        <span class="selection-counter" style="display:none;">0 selected</span>
                        <button class="btn secondary small selection-mode-btn" data-scope="mobile">Select</button>
                    </div>
                </div>
                <div class="mobile-gallery-meta-row selection-actions-row" style="display:none;">
                    <div class="gallery-inline-actions" data-scope="mobile">
                        <button class="btn secondary small select-all-btn" data-scope="mobile">Select All</button>
                        <button class="btn secondary small select-not-liked-btn" data-scope="mobile">Select Unliked</button>
                        <button class="btn secondary small clear-selection-btn" data-scope="mobile">Clear</button>
                        <button class="btn danger small bulk-delete-btn" data-scope="mobile">Delete</button>
                    </div>
                </div>
            </div>


            <div id="mobile-gallery-content" class="mobile-gallery-content pswp-gallery"></div>
        </div>

        <main class="main">
            <div class="left-panel">
                <div class="endpoint-selector">
                    <label for="endpoint-dropdown">Select Endpoint</label>
                    <div class="endpoint-dropdown-container">
                        <select id="endpoint-dropdown" class="endpoint-dropdown">
                            <option value="">Choose an endpoint...</option>
                        </select>
                    </div>
                </div>

                <div id="endpoint-info" class="endpoint-info hidden">
                    <div class="endpoint-header">
                        <img id="endpoint-thumbnail" class="endpoint-thumbnail" src="" alt="">
                        <div class="endpoint-details">
                            <h3 id="endpoint-title"></h3>
                            <p id="endpoint-category"></p>
                            <div class="endpoint-links">
                                <a id="playground-link" href="#" target="_blank" class="btn secondary small">Playground</a>
                                <a id="docs-link" href="#" target="_blank" class="btn secondary small">Docs</a>
                                <button id="delete-endpoint-btn" class="btn small endpoint-delete-btn hidden" title="Delete Custom Endpoint">Delete</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="api-form" class="api-form hidden">
                    <form id="generation-form">
                        <div id="form-fields"></div>
                    </form>
                </div>

            </div>

            <div class="right-panel">
                <!-- Right panel header tabs removed (Results button no longer needed) -->

                <div class="image-preview-area">
                    <!-- Generation Status -->
                    <div id="generation-status" class="generation-status-panel hidden">
                        <div class="status-container">
                            <div class="status-content">
                                <div class="status-title">Generating Image</div>
                                <div class="status-message" id="status-message">Submitting request...</div>
                                <div class="status-progress">
                                    <div class="progress-bar">
                                        <div class="progress-fill" id="progress-fill"></div>
                                    </div>
                                </div>
                            </div>
                            <button id="cancel-btn" class="status-cancel-btn btn secondary small">Cancel</button>
                        </div>
                    </div>

                    <div id="no-images-placeholder" class="no-images-placeholder">
                        <div class="placeholder-content">
                            <span class="placeholder-icon"><i class="ph ph-image"></i></span>
                            <h3>Generated images will appear here</h3>
                            <p>Select an endpoint and generate your first image</p>
                        </div>
                    </div>

                    <div id="results" class="results hidden">
                        <div class="results-header">
                            <h3>Generated Images</h3>
                            <div class="results-tabs">
                                <button id="images-tab" class="tab-button active">Images</button>
                                <button id="json-tab" class="tab-button">JSON</button>
                            </div>
                        </div>
                        <div id="result-images" class="result-images pswp-gallery"></div>
                        <div id="result-json" class="result-json hidden">
                            <pre><code id="json-output"></code></pre>
                        </div>
                    </div>

                    <div id="inline-gallery" class="inline-gallery hidden">
                        <div class="gallery-header">
                            <h3>Saved Images</h3>
                            <div class="gallery-header-actions">
                                <div class="gallery-inline-actions" data-scope="inline">
                                    <span class="selection-counter" style="display:none;">0 selected</span>
                                    <button class="btn secondary small selection-mode-btn" data-scope="inline">Select</button>
                                </div>
                                <div class="gallery-inline-actions selection-actions-row" data-scope="inline" style="display:none;">
                                    <button class="btn secondary small select-all-btn" data-scope="inline">Select All</button>
                                    <button class="btn secondary small select-not-liked-btn" data-scope="inline">Select Unliked</button>
                                    <button class="btn secondary small clear-selection-btn" data-scope="inline">Clear</button>
                                    <button class="btn danger small bulk-delete-btn" data-scope="inline">Delete</button>
                                </div>
                            </div>
                        </div>

                        <div id="inline-gallery-content" class="inline-gallery-content pswp-gallery"></div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Debug Panel (hidden - all debug info goes to console) -->
        <div id="debug-panel" class="debug-panel hidden" style="display: none;">
            <div class="debug-header">
                <span>Debug Log</span>
                <button id="clear-debug" class="btn secondary small">Clear</button>
            </div>
            <div id="debug-content" class="debug-content"></div>
        </div>

        <!-- Debug Toggle -->
        <div class="debug-toggle">
            <label>
                <input type="checkbox" id="debug-checkbox"> Debug Mode
            </label>
        </div>

        <!-- API Key Modal -->
        <div id="api-key-modal" class="modal hidden">
            <div class="modal-content">
                <h3>Set API Key</h3>
                <input type="password" id="api-key-input" placeholder="Enter your fal.ai API key">
                <div class="modal-actions">
                    <button id="save-api-key" class="btn primary">Save</button>
                    <button id="cancel-api-key" class="btn secondary">Cancel</button>
                </div>
            </div>
        </div>


        <!-- Custom Endpoint Modal -->
        <div id="custom-endpoint-modal" class="modal hidden">
            <div class="modal-content">
                <h3>Add Custom Endpoint</h3>

                <div class="field-group">
                    <label>OpenAPI Schema File</label>
                    <div class="upload-area" id="schema-upload-area">
                        <div class="upload-content">
                            <span><i class="ph ph-file-text"></i></span>
                            <span>Drop OpenAPI schema file here or click to browse</span>
                            <small>Supports JSON files with OpenAPI 3.0+ specification</small>
                        </div>
                        <input type="file" id="openapi-file" accept=".json" style="display: none;">
                    </div>
                    <div id="schema-file-info" class="file-info hidden">
                        <span id="schema-file-name"></span>
                        <button id="schema-remove-file" class="btn secondary small">Remove</button>
                    </div>
                </div>

                <div class="modal-actions">
                    <button id="add-custom-endpoint" class="btn primary">Add Endpoint</button>
                    <button id="cancel-custom-endpoint" class="btn secondary">Cancel</button>
                </div>
            </div>
        </div>

        <!-- Hidden file input for settings import -->
        <input type="file" id="import-file-input" accept=".json" style="display: none;">

        <!-- Gallery Context Menu -->
        <div id="gallery-context-menu" class="gallery-context-menu hidden">
            <div class="context-menu-item" data-action="download">
                <span class="context-menu-icon"><i class="ph ph-download-simple"></i></span>
                <span>Download</span>
            </div>
            <div class="context-menu-item" data-action="copy-url">
                <span class="context-menu-icon"><i class="ph ph-link"></i></span>
                <span>Copy URL</span>
            </div>
            <div class="context-menu-item" data-action="toggle-like">
                <span class="context-menu-icon"><i class="ph ph-heart"></i></span>
                <span class="toggle-like-text">Like</span>
            </div>
            <div class="context-menu-separator"></div>
            <div class="context-menu-item" data-action="set-as-input">
                <span class="context-menu-icon"><i class="ph ph-arrow-square-in"></i></span>
                <span>Set as Input</span>
            </div>
            <div class="context-menu-separator"></div>
            <div class="context-menu-item" data-action="use-prompt">
                <span class="context-menu-icon"><i class="ph ph-chat-text"></i></span>
                <span>Use Prompt</span>
            </div>
            <div class="context-menu-item" data-action="use-seed">
                <span class="context-menu-icon"><i class="ph ph-dice-five"></i></span>
                <span>Use Seed</span>
            </div>
            <div class="context-menu-separator"></div>
            <div class="context-menu-item" data-action="view-metadata">
                <span class="context-menu-icon"><i class="ph ph-info"></i></span>
                <span>View Details</span>
            </div>
            <div class="context-menu-item context-menu-restore" data-action="restore-metadata">
                <span class="context-menu-icon"><i class="ph ph-wrench"></i></span>
                <span>Restore Metadata</span>
            </div>
            <div class="context-menu-separator"></div>
            <div class="context-menu-item context-menu-danger" data-action="delete">
                <span class="context-menu-icon"><i class="ph ph-trash"></i></span>
                <span>Delete</span>
            </div>
        </div>

        <!-- Toast notifications container -->
        <div id="toast-container" class="toast-container"></div>
    </div>

    <script src="js/gallery.js"></script>
    <script src="js/app.js"></script>
    <script type="module" src="js/photoswipe-init.js"></script>
</body>
</html>